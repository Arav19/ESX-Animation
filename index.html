<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Scroll Animation Loop</title>
  <style>
    *,*::before,*::after{margin:0;padding:0;box-sizing:border-box;}
    body {
      font-family: sans-serif;
      background: #111;
      color: #fff;
    }

    section {
      padding: 100px 20px;
      border-bottom: 1px solid #333;
    }

    .spacer-line {
      height: 100px;
      border-bottom: 1px dashed #444;
      margin: 40px 0;
    }

    /* === SCROLL SEQUENCE === */
    #scroll-wrapper {
      height: 150vh; /* Extended scroll area */
      background: #000;
    }

    #scroll-sequence {
      position: relative;
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    #frame {
      width: min(80vw, 800px);
      max-width: 100%;
      transition: transform 0.2s ease-out;
    }

    #loading {
      position: absolute;
      color: white;
      font-size: 1.2rem;
    }
  </style>
</head>
<body>

  <!-- TOP CONTENT -->
  <section><div class="spacer-line"></div></section>
  <section><div class="spacer-line"></div></section>

  <!-- SCROLL SEQUENCE -->
  <div id="scroll-wrapper">
    <div id="scroll-sequence">
      <span id="loading">Loading...</span>
      <img id="frame" src="" alt="scroll animation frame" style="display: none;">
    </div>
  </div>

  <!-- BOTTOM CONTENT -->
  <section><div class="spacer-line"></div></section>
  <section><div class="spacer-line"></div></section>

  <script>
    const FRAME_COUNT = 90;
    const pad = n => String(n).padStart(4, '0');

    const imgTag = document.getElementById('frame');
    const loadingText = document.getElementById('loading');
    const wrapper = document.getElementById('scroll-wrapper');

    let imgs = [];
    let loadedImages = 0;

    // Preload all images
    for (let i = 0; i < FRAME_COUNT; i++) {
      const img = new Image();
      img.src = `${pad(i + 1)}.png`;
      img.onload = () => {
        loadedImages++;
        if (loadedImages === FRAME_COUNT) {
          // All images loaded, start animation
          loadingText.style.display = 'none';
          imgTag.style.display = 'block';
          window.addEventListener('scroll', updateFrame, { passive: true });
          window.addEventListener('resize', updateFrame);
          updateFrame();
        }
      };
      imgs.push(img);
    }

    function updateFrame() {
      const scrollTop = window.scrollY;
      const wrapperTop = wrapper.offsetTop;
      const wrapperHeight = wrapper.offsetHeight;

      const scrollInside = scrollTop - wrapperTop;
      const totalScrollable = wrapperHeight - window.innerHeight;

      let progress = scrollInside / totalScrollable;
      if (progress < 0) progress = 0;
      if (progress > 1.5) progress = 1.5;

      const frameIndex = Math.floor((progress * FRAME_COUNT)) % FRAME_COUNT;
      imgTag.src = imgs[frameIndex].src;

      // Optional zoom for effect
      const zoom = 1 + (progress % 1) * 0.1;
      imgTag.style.transform = `scale(${zoom})`;
    }
  </script>
</body>
</html>
