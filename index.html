<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Looping Scroll Animation</title>
  <style>
    *,*::before,*::after{margin:0;padding:0;box-sizing:border-box;}
    body {
      font-family: sans-serif;
      background: #111;
      color: #fff;
    }

    section {
      padding: 100px 20px;
      border-bottom: 1px solid #333;
    }

    .spacer-line {
      height: 100px;
      border-bottom: 1px dashed #444;
      margin: 40px 0;
    }

    /* === SCROLL SEQUENCE === */
    #scroll-wrapper {
      height: 150vh; /* Extended scroll area */
      background: #000;
    }

    #scroll-sequence {
      position: relative;
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    #scroll-sequence img {
      width: min(80vw, 800px);
      max-width: 100%;
      transition: transform 0.2s ease-out;
    }
  </style>
</head>
<body>

  <!-- TOP CONTENT -->
  <section><div class="spacer-line"></div></section>
  <section><div class="spacer-line"></div></section>

  <!-- SCROLL SEQUENCE -->
  <div id="scroll-wrapper">
    <div id="scroll-sequence">
      <img id="frame" src="0001.png" alt="scroll animation frame">
    </div>
  </div>

  <!-- BOTTOM CONTENT -->
  <section><div class="spacer-line"></div></section>
  <section><div class="spacer-line"></div></section>

  <script>
    const FRAME_COUNT = 90;
    const pad = n => String(n).padStart(4, '0');

    // Preload all frames
    const imgs = [];
    for (let i = 1; i <= FRAME_COUNT; i++) {
      const img = new Image();
      img.src = `${pad(i)}.png`;
      imgs.push(img);
    }

    const imgTag = document.getElementById('frame');
    const wrapper = document.getElementById('scroll-wrapper');

    function updateFrame() {
      const scrollTop = window.scrollY;
      const wrapperTop = wrapper.offsetTop;
      const wrapperHeight = wrapper.offsetHeight;

      // How far the scroll is inside the wrapper
      const scrollInside = scrollTop - wrapperTop;
      const totalScrollable = wrapperHeight - window.innerHeight;

      // Scroll progress as 0 to 1
      let progress = scrollInside / totalScrollable;

      // Allow animation even before/after it's fully in view
      // Clamp but also allow negative or over 1 to loop
      if (progress < 0) progress = 0;
      if (progress > 1.5) progress = 1.5;

      // Loop: wrap the frame index
      const frameIndex = Math.floor((progress * FRAME_COUNT)) % FRAME_COUNT;
      imgTag.src = `${pad(frameIndex)}.png`;

      // Optional: zoom for extra drama
      const zoom = 1 + (progress % 1) * 0.1;
      imgTag.style.transform = `scale(${zoom})`;
    }

    window.addEventListener('scroll', updateFrame, { passive: true });
    window.addEventListener('resize', updateFrame);
    updateFrame();
  </script>
</body>
</html>
